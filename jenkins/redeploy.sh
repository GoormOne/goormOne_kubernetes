#!/bin/bash

# Jenkins ì¬ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
set -e

echo "ğŸ”„ Redeploying Jenkins with custom image..."

# 1. ê¸°ì¡´ Jenkins pod ì‚­ì œ
echo "Deleting existing Jenkins pods..."
kubectl delete pods -l app=jenkins -n jenkins --ignore-not-found=true

# 2. ë°°í¬ ì—…ë°ì´íŠ¸
echo "Applying custom Jenkins deployment..."
kubectl apply -f jenkins-dp-custom.yaml

# 3. ë°°í¬ ìƒíƒœ í™•ì¸
echo "Waiting for Jenkins to be ready..."
kubectl rollout status deployment/jenkins -n jenkins --timeout=300s

# 4. Pod ìƒíƒœ í™•ì¸
echo ""
echo "ğŸ“Š Current Jenkins pod status:"
kubectl get pods -l app=jenkins -n jenkins -o wide

echo ""
echo "ğŸ“ To check logs:"
echo "kubectl logs -f deployment/jenkins -n jenkins"

echo ""
echo "ğŸŒ To access Jenkins:"
echo "kubectl port-forward -n jenkins deployment/jenkins 8080:8080"

echo ""
echo "âœ… Jenkins redeployment completed!"
